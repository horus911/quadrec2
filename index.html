<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Quadrec2 - Partage de médias</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://static.addtoany.com/menu/page.js" async></script>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
    }
    h1 {
      text-align: center;
      color: #333;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    textarea, input[type="file"], input[type="text"], button {
      width: 100%;
      margin-top: 10px;
      padding: 10px;
      font-size: 1em;
    }
    .preview {
      margin-top: 10px;
    }
    .preview img, .preview video, .preview audio {
      max-width: 100%;
      display: block;
      margin-top: 10px;
    }
    .section {
      margin-top: 30px;
    }
    .a2a_kit {
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Quadrec2 - Partage de médias</h1>

    <div class="section">
      <label>Texte à partager :</label>
      <textarea id="textInput" rows="4" placeholder="Tape ton message ici..."></textarea>
    </div>

    <div class="section">
      <label>Image :</label>
      <input type="file" accept="image/*" id="imageInput">
      <div class="preview" id="imagePreview"></div>
    </div>

    <div class="section">
      <label>Vidéo :</label>
      <input type="file" accept="video/*" id="videoInput">
      <div class="preview" id="videoPreview"></div>
    </div>

    <div class="section">
      <label>Audio :</label>
      <input type="file" accept="audio/*" id="audioInput">
      <div class="preview" id="audioPreview"></div>
    </div>

    <div class="section">
      <label>Lien à partager :</label>
      <input type="text" id="shareLink" readonly>
      <div class="a2a_kit a2a_default_style a2a_kit_size_32">
        <a class="a2a_button_facebook"></a>
        <a class="a2a_button_twitter"></a>
        <a class="a2a_button_whatsapp"></a>
        <a class="a2a_button_email"></a>
        <a class="a2a_dd" href="https://www.addtoany.com/share"></a>
      </div>
    </div>
  </div>

  <script>
    const textInput = document.getElementById('textInput');
    const imageInput = document.getElementById('imageInput');
    const videoInput = document.getElementById('videoInput');
    const audioInput = document.getElementById('audioInput');
    const shareLink = document.getElementById('shareLink');

    const imagePreview = document.getElementById('imagePreview');
    const videoPreview = document.getElementById('videoPreview');
    const audioPreview = document.getElementById('audioPreview');

    const files = { image: null, video: null, audio: null };

    function updatePreview(id, file, previewContainer, type) {
      if (!file) {
        previewContainer.innerHTML = '';
        return;
      }
      const reader = new FileReader();
      reader.onload = function (e) {
        const src = e.target.result;
        if (type === 'image') {
          previewContainer.innerHTML = `<img src="${src}">`;
        } else if (type === 'video') {
          previewContainer.innerHTML = `<video controls src="${src}"></video>`;
        } else if (type === 'audio') {
          previewContainer.innerHTML = `<audio controls src="${src}"></audio>`;
        }
        files[type] = src;
        generateLink();
      };
      reader.readAsDataURL(file);
    }

    function generateLink() {
      const data = {
        text: textInput.value,
        image: files.image,
        video: files.video,
        audio: files.audio
      };
      try {
        const json = JSON.stringify(data);
        const encoded = encodeURIComponent(json);
        const link = `${location.origin}${location.pathname}?data=${encoded}`;
        shareLink.value = link;
      } catch (e) {
        shareLink.value = 'Erreur lors de la génération du lien';
      }
    }

    function restoreFromURL() {
      const params = new URLSearchParams(location.search);
      const dataParam = params.get('data');
      if (dataParam) {
        try {
          const data = JSON.parse(decodeURIComponent(dataParam));
          if (data.text) textInput.value = data.text;
          if (data.image) {
            files.image = data.image;
            imagePreview.innerHTML = `<img src="${data.image}">`;
          }
          if (data.video) {
            files.video = data.video;
            videoPreview.innerHTML = `<video controls src="${data.video}"></video>`;
          }
          if (data.audio) {
            files.audio = data.audio;
            audioPreview.innerHTML = `<audio controls src="${data.audio}"></audio>`;
          }
        } catch (e) {
          console.error('Erreur de décodage de l’URL');
        }
      }
      generateLink();
    }

    textInput.addEventListener('input', generateLink);
    imageInput.addEventListener('change', e => updatePreview('image', e.target.files[0], imagePreview, 'image'));
    videoInput.addEventListener('change', e => updatePreview('video', e.target.files[0], videoPreview, 'video'));
    audioInput.addEventListener('change', e => updatePreview('audio', e.target.files[0], audioPreview, 'audio'));

    restoreFromURL();
  </script>
</body>
</html>
